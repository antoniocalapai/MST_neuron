<?xml version="1.0" standalone="no"?>
<monkeyml version="1.0">
    <io_devices tag="IO Devices">
        <iodevice type="stimulus_display" tag="Stimulus Display" background_color="0, 0, 0"></iodevice>
        <iodevice tag="MSSWGamepad" priority="" data_type="event" type="sidewinder_gamepad" data_interval="50ms" up="" down="" left="" right="" trigger_right="IO_gp_triggerRight" trigger_left="IO_gp_triggerLeft" lower_trigger_right="" lower_trigger_left="" a="IO_gp_a" b="" x="" y=""></iodevice>
    </io_devices>
    <variables tag="Variables">
        <variable tag="EXP_version" scope="global" logging="when_changed" default_value="0" type="string"></variable>
        <folder tag="IO_params">
            <variable tag="IO_gp_triggerRight" scope="global" logging="when_changed" default_value="0" type="boolean"></variable>
            <variable tag="IO_gp_triggerLeft" scope="global" logging="when_changed" default_value="0" type="boolean"></variable>
            <variable tag="IO_gp_a" scope="global" logging="when_changed" default_value="0" type="boolean"></variable>
        </folder>
        <folder tag="ML_params">
            <variable tag="ML_trialStart" scope="global" logging="when_changed" default_value="0" type="integer"></variable>
            <variable tag="ML_trialEnd" scope="global" logging="when_changed" default_value="0" type="integer"></variable>
            <variable tag="ML_sync" scope="global" logging="when_changed" default_value="0" type="boolean"></variable>
        </folder>
        <variable tag="SC_top_in" scope="global" logging="when_changed" default_value="0" type="boolean"></variable>
        <variable tag="SC_top_out" scope="global" logging="when_changed" default_value="0" type="float"></variable>
        <variable tag="SC_top_index" scope="global" logging="when_changed" default_value="1" type="integer"></variable>
        <variable tag="SC_bottom_in" scope="global" logging="when_changed" default_value="0" type="boolean"></variable>
        <variable tag="SC_bottom_out" scope="global" logging="when_changed" default_value="0" type="float"></variable>
        <variable tag="SC_bottom_index" scope="global" logging="when_changed" default_value="1" type="integer"></variable>
        <variable tag="RDP_direction" scope="global" logging="when_changed" default_value="0" type="float"></variable>
        <variable tag="PRIV_scSelector" scope="global" logging="when_changed" default_value="0" type="integer"></variable>
    </variables>
    <sounds tag="Sounds"></sounds>
    <stimuli tag="Stimuli">
        <stimulus type="blank_screen" tag="background" color="0,0,0"></stimulus>
        <stimulus type="dynamic_random_dots" tag="RDP" RDP_type="&quot;linear&quot;" field_radius="5.0" field_center_x="0.0" field_center_y="0.0" field_center_z="0.0" num_dots="100" dot_size="0.1" dot_lifetime="-1" color="&quot;1.0,1.0,1.0&quot;" alpha_multiplier="1.0" direction="RDP_direction" direction_lifetime="-1" speed="3.0" speed_lifetime="-1" reinitialize="0" version="EXP_version"></stimulus>
    </stimuli>
    <filters tag="Filters"></filters>
    <optimizers tag="Optimizers">
        <filter type="Staircase_Optimizer" tag="Staircase_top" input="SC_top_in" output="SC_top_out" steps_csv="&quot;10 7.5 5 4 3 2.5 2 1.5 1 0.5 0 -0.5 -1 -1.5 -2 -2.5 -3&quot;" index="SC_top_index" leftCriterion="1" rightCriterion="2" version="EXP_version"></filter>
        <filter type="Staircase_Optimizer" tag="Staircase_bottom" input="SC_bottom_in" output="SC_bottom_out" steps_csv="&quot;-10 -7.5 -5 -4 -3 -2.5 -2 -1.5 -1 -0.5 0 0.5 1 1.5 2 2.5 3&quot;" index="SC_bottom_index" leftCriterion="1" rightCriterion="2" version="EXP_version"></filter>
    </optimizers>
    <experiment tag="Direction Discrimination" full_name="" description="">
        <protocol tag="Simple w/o Staircase" nsamples="1" sampling_method="cycles" selection="sequential" interruptible="YES">
            <action tag="Start Gamepad" type="start_device_IO" device="MSSWGamepad"></action>
            <action tag="Queue background" type="queue_stimulus" stimulus="background"></action>
            <action tag="Update Stimulus Display (init)" type="update_stimulus_display"></action>
            <block tag="Loop" nsamples="10" sampling_method="cycles" selection="sequential" interruptible="YES">
                <task_system tag="State System for one Trial" interruptible="YES">
                    <task_system_state tag="START" interruptible="YES">
                        <action_marker _unmoveable="1" tag="Actions"></action_marker>
                        <action type="report" tag="Announce *wait for user*" message="# Wait for start signal from user..."></action>
                        <transition_marker _unmoveable="1" tag="Transitions"></transition_marker>
                        <transition type="conditional" tag="If IO_gp_a is TRUE, Transition to WAIT_FOR_TRIALSTART" condition="IO_gp_a" target="WAIT_FOR_TRIALSTART"></transition>
                    </task_system_state>
                    <task_system_state tag="WAIT_FOR_TRIALSTART" interruptible="YES">
                        <action_marker _unmoveable="1" tag="Actions"></action_marker>
                        <transition_marker _unmoveable="1" tag="Transitions"></transition_marker>
                        <transition type="conditional" tag="If IO_gp_button is FALSE, Transition to SHOW_DIRECTION" condition="!IO_gp_a &amp;&amp; !IO_gp_triggerLeft &amp;&amp; !IO_gp_triggerRight" target="SHOW_DIRECTION"></transition>
                    </task_system_state>
                    <task_system_state tag="SHOW_DIRECTION" interruptible="YES">
                        <action_marker _unmoveable="1" tag="Actions"></action_marker>
                        <action type="assignment" tag="set ML_sync = true" variable="ML_sync" value="1"></action>
                        <action type="assignment" tag="set ML_trialStart" variable="ML_trialStart" value="ML_trialStart + 1"></action>
                        <action type="assignment" tag="set RDP_direction" variable="RDP_direction" value="( disc_rand(0,40) / 2.0 ) - 10.0"></action>
                        <action type="report" tag="Report trialStart" message="# trial No $ML_trialStart with direction $RDP_direction"></action>
                        <action type="wait" tag="Wait (250ms)" duration="150" duration_units="ms"></action>
                        <action tag="Queue RDP" type="queue_stimulus" stimulus="RDP"></action>
                        <action tag="Update Stimulus Display (RDP)" type="update_stimulus_display"></action>
                        <action type="start_timer" tag="Start Timer (showRDP)" timer="showRDP" timebase="" duration="500" duration_units="ms"></action>
                        <transition_marker _unmoveable="1" tag="Transitions"></transition_marker>
                        <transition type="conditional" tag="If IO_gp_Button is TRUE, Transition to WAIT_FOR_ANSWER" condition="IO_gp_triggerLeft || IO_gp_triggerRight" target="WAIT_FOR_ANSWER"></transition>
                        <transition type="timer_expired" tag="If showRDP Expired, Transition to WAIT_FOR_ANSWER" target="WAIT_FOR_ANSWER" timer="showRDP"></transition>
                    </task_system_state>
                    <task_system_state tag="WAIT_FOR_ANSWER" interruptible="YES">
                        <action_marker _unmoveable="1" tag="Actions"></action_marker>
                        <action tag="Dequeue RDP" type="dequeue_stimulus" stimulus="RDP"></action>
                        <action tag="Update Stimulus Display (no RDP)" type="update_stimulus_display"></action>
                        <transition_marker _unmoveable="1" tag="Transitions"></transition_marker>
                        <transition type="conditional" tag="If IO_gp_Button is TRUE, Transition to GET_ANSWER" condition="IO_gp_triggerLeft || IO_gp_triggerRight" target="GET_ANSWER"></transition>
                    </task_system_state>
                    <task_system_state tag="GET_ANSWER" interruptible="YES">
                        <action_marker _unmoveable="1" tag="Actions"></action_marker>
                        <action type="report" tag="Report trialEnd" message="# get answer: $IO_gp_triggerLeft - $IO_gp_triggerRight"></action>
                        <action type="assignment" tag="set ML_trialEnd" variable="ML_trialEnd" value="ML_trialStart"></action>
                        <action type="assignment" tag="set ML_sync = false" variable="ML_sync" value="0"></action>
                        <transition_marker _unmoveable="1" tag="Transitions"></transition_marker>
                        <transition type="conditional" tag="If IO_gp_Button is FALSE, Transition to EXIT" condition="!IO_gp_triggerLeft &amp;&amp; !IO_gp_triggerRight" target="EXIT"></transition>
                    </task_system_state>
                    <task_system_state tag="EXIT" interruptible="YES">
                        <action_marker _unmoveable="1" tag="Actions"></action_marker>
                        <action type="wait" tag="Wait (ITI)" duration="50" duration_units="ms"></action>
                        <transition_marker _unmoveable="1" tag="Transitions"></transition_marker>
                        <transition tag="Return to parent task system" type="yield"></transition>
                    </task_system_state>
                </task_system>
            </block>
            <action tag="Dequeue background" type="dequeue_stimulus" stimulus="background"></action>
            <action tag="Stop Gamepad" type="stop_device_IO" device="MSSWGamepad"></action>
        </protocol>
        <protocol tag="Simple with Staircase" nsamples="1" sampling_method="cycles" selection="sequential" interruptible="YES">
            <action tag="Start Gamepad" type="start_device_IO" device="MSSWGamepad"></action>
            <action tag="Queue background" type="queue_stimulus" stimulus="background"></action>
            <action tag="Update Stimulus Display (init)" type="update_stimulus_display"></action>
            <block tag="Loop" nsamples="200" sampling_method="cycles" selection="sequential" interruptible="YES">
                <task_system tag="State System for one Trial" interruptible="YES">
                    <task_system_state tag="START" interruptible="YES">
                        <action_marker _unmoveable="1" tag="Actions"></action_marker>
                        <action type="report" tag="Announce *wait for user*" message="# Wait for start signal from user..."></action>
                        <transition_marker _unmoveable="1" tag="Transitions"></transition_marker>
                        <transition type="conditional" tag="If IO_gp_a is TRUE, Transition to WAIT_FOR_TRIALSTART" condition="IO_gp_a" target="WAIT_FOR_TRIALSTART"></transition>
                    </task_system_state>
                    <task_system_state tag="WAIT_FOR_TRIALSTART" interruptible="YES">
                        <action_marker _unmoveable="1" tag="Actions"></action_marker>
                        <transition_marker _unmoveable="1" tag="Transitions"></transition_marker>
                        <transition type="conditional" tag="If IO_gp_button is FALSE, Transition to SHOW_DIRECTION" condition="!IO_gp_a &amp;&amp; !IO_gp_triggerLeft &amp;&amp; !IO_gp_triggerRight" target="SHOW_DIRECTION"></transition>
                    </task_system_state>
                    <task_system_state tag="SHOW_DIRECTION" interruptible="YES">
                        <action_marker _unmoveable="1" tag="Actions"></action_marker>
                        <action type="assignment" tag="set ML_sync = true" variable="ML_sync" value="1"></action>
                        <action type="assignment" tag="set ML_trialStart" variable="ML_trialStart" value="ML_trialStart + 1"></action>
                        <action type="assignment" tag="set PRIV_scSelector" variable="PRIV_scSelector" value="disc_rand(0, 1)"></action>
                        <action type="report" tag="DEBUG_priv_scselector" message="DEBUG PRIV_scSelector = $PRIV_scSelector"></action>
                        <action type="if" tag="use SC_top" condition="PRIV_scSelector == 1">
                            <action type="assignment" tag="RDP_direction = SC_top_out" variable="RDP_direction" value="SC_top_out"></action>
                        </action>
                        <action type="if" tag="use SC_bottom" condition="PRIV_scSelector == 0">
                            <action type="assignment" tag="RDP_direction = SC_bottom_out" variable="RDP_direction" value="SC_bottom_out"></action>
                        </action>
                        <action type="report" tag="Report trialStart" message="# trial No $ML_trialStart with direction $RDP_direction"></action>
                        <action type="wait" tag="Wait (250ms)" duration="150" duration_units="ms"></action>
                        <action tag="Queue RDP" type="queue_stimulus" stimulus="RDP"></action>
                        <action tag="Update Stimulus Display (RDP)" type="update_stimulus_display"></action>
                        <action type="start_timer" tag="Start Timer (showRDP)" timer="showRDP" timebase="" duration="500" duration_units="ms"></action>
                        <transition_marker _unmoveable="1" tag="Transitions"></transition_marker>
                        <transition type="conditional" tag="If IO_gp_Button is TRUE, Transition to WAIT_FOR_ANSWER" condition="IO_gp_triggerLeft || IO_gp_triggerRight" target="WAIT_FOR_ANSWER"></transition>
                        <transition type="timer_expired" tag="If showRDP Expired, Transition to WAIT_FOR_ANSWER" target="WAIT_FOR_ANSWER" timer="showRDP"></transition>
                    </task_system_state>
                    <task_system_state tag="WAIT_FOR_ANSWER" interruptible="YES">
                        <action_marker _unmoveable="1" tag="Actions"></action_marker>
                        <action tag="Dequeue RDP" type="dequeue_stimulus" stimulus="RDP"></action>
                        <action tag="Update Stimulus Display (no RDP)" type="update_stimulus_display"></action>
                        <transition_marker _unmoveable="1" tag="Transitions"></transition_marker>
                        <transition type="conditional" tag="If IO_gp_Button is TRUE, Transition to GET_ANSWER" condition="IO_gp_triggerLeft || IO_gp_triggerRight" target="GET_ANSWER"></transition>
                    </task_system_state>
                    <task_system_state tag="GET_ANSWER" interruptible="YES">
                        <action_marker _unmoveable="1" tag="Actions"></action_marker>
                        <action type="if" tag="if SC_top" condition="PRIV_scSelector == 1">
                            <action type="assignment" tag="set SC_top_in" variable="SC_top_in" value="IO_gp_triggerRight"></action>
                        </action>
                        <action type="if" tag="if SC_bottom" condition="PRIV_scSelector == 0">
                            <action type="assignment" tag="set SC_bottom_in" variable="SC_bottom_in" value="IO_gp_triggerLeft"></action>
                        </action>
                        <action type="report" tag="Report trialEnd" message="# get answer: $IO_gp_triggerLeft - $IO_gp_triggerRight"></action>
                        <action type="assignment" tag="set ML_trialEnd" variable="ML_trialEnd" value="ML_trialStart"></action>
                        <action type="assignment" tag="set ML_sync = false" variable="ML_sync" value="0"></action>
                        <transition_marker _unmoveable="1" tag="Transitions"></transition_marker>
                        <transition type="conditional" tag="If IO_gp_Button is FALSE, Transition to EXIT" condition="!IO_gp_a &amp;&amp; !IO_gp_triggerLeft &amp;&amp; !IO_gp_triggerRight" target="EXIT"></transition>
                    </task_system_state>
                    <task_system_state tag="EXIT" interruptible="YES">
                        <action_marker _unmoveable="1" tag="Actions"></action_marker>
                        <action type="wait" tag="Wait (ITI)" duration="50" duration_units="ms"></action>
                        <transition_marker _unmoveable="1" tag="Transitions"></transition_marker>
                        <transition tag="Return to parent task system" type="yield"></transition>
                    </task_system_state>
                </task_system>
            </block>
            <action tag="Dequeue background" type="dequeue_stimulus" stimulus="background"></action>
            <action tag="Stop Gamepad" type="stop_device_IO" device="MSSWGamepad"></action>
        </protocol>
    </experiment>
</monkeyml>